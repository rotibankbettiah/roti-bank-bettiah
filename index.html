
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Roti Bank Bettiah is a registered non-profit organization in Bettiah, Bihar, dedicated to providing food and aid to the underprivileged.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roti Bank Bettiah | Serving the Needy with Food & Compassion</title>
    <link rel="icon" type="image/x-icon" href="download-WeResize.com (1).png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Base Styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            scroll-behavior: smooth;
        } 

        /* Reusable Components */
        .section-container {
            padding: 4rem 1rem;
        }

        .heading {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1f2937;
            text-align: center;
            margin-bottom: 2rem;
        }

        .icon {
            font-size: 3rem;
            color: #047857;
        }

        .card {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .firebase-error {
            color: red;
            text-align: center;
            margin-top: 1rem;
            font-weight: bold;
        }
        
        /* Image Optimization */
        .full-visible-image {
            width: 100%;
            height: auto;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease-in-out;
        }
        
        .gallery-item:hover .full-visible-image {
            transform: scale(1.05);
        }
        
        /* Navbar Scrolled State */
        .navbar-hidden {
            transform: translateY(-100%);
            opacity: 0;
            visibility: hidden;
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }
        
        /* Gallery Slideshow */
        .slideshow-container {
            position: relative;
            max-width: 800px;
            margin: auto;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .slideshow-img {
            display: none;
            width: 100%;
            height: 400px;
            object-fit: contain;
        }
        .slideshow-caption {
            position: absolute;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            width: 100%;
            padding: 1rem;
            text-align: center;
            font-size: 1.25rem;
        }
        .fade {
            animation-name: fade;
            animation-duration: 1.5s;
        }
        @keyframes fade {
            from { opacity: 0.4; }
            to { opacity: 1; }
        }

        .map-pin {
            animation: pulse 1.5s infinite;
        }

        /* Base Styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            scroll-behavior: smooth;
        } 

        /* Reusable Components */
        .section-container {
            padding: 4rem 1rem;
        }

        .heading {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1f2937;
            text-align: center;
            margin-bottom: 2.5rem;
        }

        /* --- Chatbot Specific Styles --- */
        #chatbot-icon {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            cursor: pointer;
            width: 60px;
            height: 60px;
            box-shadow: #047857;
            transition: transform 0.2s;
        }

        #chatbot-icon:hover {
            transform: scale(1.05);
        }

        #chat-widget {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 100%;
            max-width: 380px;
            height: 500px;
            z-index: 1000;
            border-radius: 12px;
            box-shadow: 0 8px 25px #047857;
            display: none; /* Hidden by default */
            flex-direction: column;
            overflow: hidden;
        }

        @media (max-width: 600px) {
            #chat-widget {
                bottom: 0;
                right: 0;
                width: 100%;
                max-width: none;
                height: 100%;
                border-radius: 0;
            }
            #chatbot-icon {
                display: none; /* Hide icon on full screen chat */
            }
        }

        /* Chat bubble styles */
        .message-bubble-user {
            background-color: #3b82f6; /* blue-500 */
            color: white;
            border-radius: 15px 15px 4px 15px;
        }
        .message-bubble-ai {
            background-color: #e5e7eb; /* gray-200 */
            color: #1f2937; /* gray-800 */
            border-radius: 15px 15px 15px 4px;
        }
        
        /* Ensure images and links inside the AI bubble are formatted correctly */
        .message-bubble-ai img {
            display: block;
            margin: 0.5rem auto; /* Center image */
        }
        .message-bubble-ai a {
            word-break: break-all;
        }

        /* Typing indicator dots */
        .dot {
            display: inline-block;
            width: 6px;
            height: 6px;
            margin-right: 3px;
            background-color: #4a4a4a;
            border-radius: 50%;
            animation: dot-flicker 1.4s infinite ease-in-out both;
        }
        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }
        .dot:nth-child(3) { animation-delay: 0s; }

        @keyframes dot-flicker {
            0%, 80%, 100% {
                transform: scale(0);
            }
            40% {
                transform: scale(1.0);
            }
        }
    </style>
</head>
<!-- --- Chatbot Widget HTML --- -->
    <button id="chatbot-icon" class="bg-green-600 text-white rounded-full flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"/>
        </svg>
    </button>

    <div id="chat-widget" class="bg-white">
        <!-- Chat Header -->
        <header class="bg-green-700 text-white p-3 rounded-t-xl flex justify-between items-center shadow-md">
            <div class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                </svg>
                <h2 class="font-bold">Roti Bank Assistant</h2>
            </div>
            <button id="chat-close-btn" class="text-white hover:text-gray-200 p-1 rounded-full">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
        </header>

        <!-- Chat Container -->
        <main id="chat-container" class="flex-1 p-3 overflow-y-auto bg-gray-50">
            <div class="message-group flex justify-start mb-3">
                <div class="message-bubble-ai p-3 max-w-[80%] text-sm">
                    <p>Hello! I am the Roti Bank assistant. I can help you with donations, volunteering, or general information about our mission.</p>
                </div>
            </div>
        </main>

        <!-- Chat Input -->
        <footer class="p-3 bg-white border-t border-gray-200">
            <form id="chat-form" class="flex items-center space-x-2">
                <input type="text" id="user-input" placeholder="Ask a question..." class="flex-1 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-sm">
                <button type="submit" class="bg-green-600 text-white p-2 rounded-lg hover:bg-green-700 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                    </svg>
                </button>
            </form>
        </footer>
    </div>
    <!-- --- End Chatbot Widget HTML --- -->

    <!-- ========================================================================================================= -->
    <!-- --- START OF ORIGINAL ROTI BANK BETTIAH CONTENT --- -->
    <!-- ========================================================================================================= -->


    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1969DFFK5H"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-1969DFFK5H');
</script>


    
<body class="text-gray-900">
    <!-- Navigation bar -->
    <nav id="navbar" class="sticky top-0 z-50 bg-white shadow-lg backdrop-filter backdrop-blur-lg bg-opacity-70 transition-all duration-300 ease-in-out">
        <div class="container mx-auto px-4 py-4 text-center">
            <img id="nav-logo" src="download-WeResize.com (1).png" alt="Roti Bank Bettiah Logo" class="mx-auto h-12 mb-2 rounded-full shadow-lg transition-all duration-300 ease-in-out">
            <a id="nav-title" href="#home" class="font-bold text-4xl text-emerald-700 block mb-2 transition-all duration-300 ease-in-out">Roti Bank Bettiah</a>
            
            <span class="text-sm font-normal text-gray-600">(Reg. No.- 5071/2023)</span>
            <div id="nav-links" class="space-x-4 flex justify-center flex-wrap transition-all duration-300 ease-in-out">
                <a href="#gallery" class="text-gray-700 hover:text-emerald-600 transition-colors duration-300">Gallery</a>
                <a href="#about" class="text-gray-700 hover:text-emerald-600 transition-colors duration-300">About Us</a>
                <a href="https://maps.app.goo.gl/iUDm3AZMNMM91PDN6?g_st=aw" target="_blank" class="text-gray-700 hover:text-emerald-600 transition-colors duration-300">Location</a>
                <a href="#achievements" class="text-gray-700 hover:text-emerald-600 transition-colors duration-300">Achievements</a>
                <a href="#branches" class="text-gray-700 hover:text-emerald-600 transition-colors duration-300">Branches</a>
                <a href="#internship" class="text-gray-700 hover:text-emerald-600 transition-colors duration-300">Internship</a>
                <a href="#activities" class="text-gray-700 hover:text-emerald-600 transition-colors duration-300">Activities</a>
                <a href="#notices" class="text-gray-700 hover:text-emerald-600 transition-colors duration-300">Notice</a>
                <a href="#causes" class="text-gray-700 hover:text-emerald-600 transition-colors duration-300">Causes</a>
                <a href="#news" class="text-gray-700 hover:text-emerald-600 transition-colors duration-300">News</a>
                <a href="#donation" class="text-gray-700 hover:text-emerald-600 transition-colors duration-300">Donate</a>
            </div>
        </div>
    </nav>
    
    <!-- Header/Hero Section -->
    <header id="home" class="bg-cover bg-center text-white py-24 text-center relative" style="background-image: url('https://placehold.co/1200x600/10B981/FFFFFF?text=Nourishing+Lives');">
        <div class="absolute inset-0 bg-black opacity-50"></div>
        <div class="container mx-auto px-4 relative z-10">
            <h1 class="text-5xl font-extrabold mb-4">Nourishing Lives, One Roti at a Time</h1>
            <p class="text-xl font-light mb-8">Empowering our community through food and compassion.</p>
            <a href="#donation" class="inline-block px-8 py-3 bg-white text-emerald-600 font-bold rounded-full shadow-lg hover:bg-gray-100 transition-transform duration-300 transform hover:scale-105">Donate Now</a>
        </div>
    </header>

    <main>
        <!-- Gallery Section -->
        <section id="gallery" class="section-container bg-white">
            <div class="container mx-auto px-4">
                <h2 class="heading">Our Gallery</h2>
                <div id="gallery-slideshow" class="slideshow-container">
                    <p>Loading...</p>
                </div>
                <div id="slideshow-controls" class="text-center mt-4 space-x-4">
                    <button id="prev-btn" class="px-4 py-2 bg-gray-300 rounded-full shadow-md hover:bg-gray-400">Previous</button>
                    <button id="pause-btn" class="px-4 py-2 bg-gray-300 rounded-full shadow-md hover:bg-gray-400">Pause</button>
                    <button id="next-btn" class="px-4 py-2 bg-gray-300 rounded-full shadow-md hover:bg-gray-400">Next</button>
                </div>
            </div>
        </section>

        <!-- About Us Section -->
        <section id="about" class="section-container bg-white">
            <div class="container mx-auto px-4">
                <h2 class="heading">About Us</h2>
                <div class="max-w-3xl mx-auto text-center space-y-6" id="about-content-container">
                    <!-- Content will be loaded from Supabase here -->
                    <p class="text-lg text-gray-700">Loading...</p>
                </div>
                <div class="text-center mt-8">
                    <a href="about.html" class="inline-block px-6 py-3 bg-emerald-500 text-white rounded-full shadow-md hover:bg-emerald-600 transition-colors duration-300">Know More</a>
                </div>
            </div>
        </section>

        <!-- Location Section -->
        <section class="section-container bg-gray-100">
            <div class="container mx-auto px-4 text-center">
                <h2 class="heading">Our Location</h2>
                <div class="flex flex-col items-center justify-center">
                    <svg class="map-pin w-16 h-16 text-green-500 mb-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M5.056 4.944A7.447 7.447 0 0110 2.5c4.142 0 7.5 3.358 7.5 7.5a7.447 7.447 0 01-2.444 5.056L10 20l-5.056-5.056A7.447 7.447 0 012.5 10c0-4.142 3.358-7.5 7.5-7.5zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"></path>
                    </svg>
                    <p class="text-lg text-gray-700 font-medium mb-4">Roti Bank Bettiah Trust - NGO - Free daily Food in Bettiah - Social work - Welfare Society</p>
                    <a href="https://maps.app.goo.gl/iUDm3AZMNMM91PDN6?g_st=aw" target="_blank" class="inline-block px-6 py-3 bg-emerald-500 text-white rounded-full shadow-md hover:bg-emerald-600 transition-colors duration-300">Open in Google Maps</a>
                </div>
            </div>
        </section>

        <!-- Achievements Section -->
        <section id="achievements" class="section-container bg-gray-100">
            <div class="container mx-auto px-4">
                <h2 class="heading">Our Achievements</h2>
                <div id="achievements-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <p>Loading...</p>
                </div>
            </div>
        </section>

        <!-- Our Branches Section -->
        <section id="branches" class="section-container bg-white">
            <div class="container mx-auto px-4">
                <h2 class="heading">Our Branches</h2>
                <div id="branches-list" class="flex flex-wrap justify-center gap-4">
                    <p>Loading...</p>
                </div>
            </div>
        </section>

        <!-- Internship Section -->
        <section id="internship" class="section-container bg-white">
            <div class="container mx-auto px-4">
                <h2 class="heading">Internship Corner</h2>
                <div id="internship-content" class="text-center space-y-6">
                    <p>Loading...</p>
                </div>
                <div class="text-center mt-8">
                    <button id="apply-internship-btn" class="inline-block px-6 py-3 bg-emerald-500 text-white rounded-full shadow-md hover:bg-emerald-600 transition-colors duration-300">
                        Apply for Internship
                    </button>
                </div>
            </div>
        </section>

        <!-- Activities Section -->
        <section id="activities" class="section-container bg-white">
            <div class="container mx-auto px-4">
                <h2 class="heading">Our Activities</h2>
                <div class="max-w-3xl mx-auto space-y-6 text-lg text-gray-700" id="activities-list-container">
                    <p>Loading...</p>
                </div>
            </div>
        </section>

        <!-- Notice Board Section -->
        <section id="notices" class="section-container bg-gray-100">
            <div class="container mx-auto px-4">
                <h2 class="heading">Notice Board</h2>
                <div class="max-w-3xl mx-auto space-y-6 text-lg text-gray-700" id="notices-list-container">
                    <p>Loading...</p>
                </div>
            </div>
        </section>

        <!-- Causes Section -->
        <section id="causes" class="section-container bg-white">
            <div class="container mx-auto px-4">
                <h2 class="heading">Featured Causes</h2>
                <p id="firebase-error" class="firebase-error hidden"></p>
                <div class="max-w-4xl mx-auto">
                    <div id="causes-list" class="space-y-6">
                        <p>Loading...</p>
                    </div>
                </div>
            </div>
        </section>
        
       <!-- News Section -->
        <section id="news" class="section-container bg-gray-100">
            <div class="container mx-auto px-4">
                <h2 class="heading">Latest News</h2>
                <div class="max-w-4xl mx-auto">
                    <div id="news-list" class="space-y-6">
                        <p class="text-center text-gray-500">Loading news...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Donation Section -->
        <section id="donation" class="section-container bg-gray-100">
            <div class="container mx-auto px-4">
                <h2 class="heading">Donate Us</h2>
                <div class="max-w-3xl mx-auto flex flex-col md:flex-row items-center justify-center gap-8">
                    <div class="card flex-1 p-8 text-center">
                        <img id="donation-qr" src="QR.png.jpg" alt="QR Code" class="w-64 h-64 mx-auto mb-4 rounded-lg shadow-lg" loading="lazy">
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Bank Account Details</h3>
                        <p class="text-gray-700">Account Holder Name: <span id="account-holder-name" class="font-semibold">ROTI BANK BETTIAH</span></p>
                        <p class="text-gray-700">Bank Name: <span id="bank-name" class="font-semibold">PUNJAB NATIONAL BANK</span></p>
                        <p class="text-gray-700">Account Number: <span id="account-number" class="font-semibold">1919202100001486</span></p>
                        <p class="text-gray-700">IFSC Code: <span id="ifsc-code" class="font-semibold">PUNB0191920</span></p>
                    </div>
                    
                    <div class="card flex-1 p-8">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Generate Your Receipt</h3>
                        <form id="receipt-form" class="space-y-4">
                            <input type="text" id="donar-name" placeholder="Your Name" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-colors duration-200">
                            <input type="number" id="amount" placeholder="Amount (in ₹)" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-colors duration-200">
                            <input type="text" id="transaction-id" placeholder="Transaction ID" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-colors duration-200">
                            <button type="submit" class="w-full px-4 py-2 bg-emerald-500 text-white rounded-lg shadow-sm font-bold hover:bg-emerald-600 transition-colors duration-200">
                                Generate Receipt
                            </button>
                        </form>
                        <div id="message-box" class="hidden text-center mt-4 p-3 rounded-lg bg-emerald-100 text-emerald-800 font-medium"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Social Media Section -->
        <section id="social-media" class="section-container bg-white">
            <div class="container mx-auto px-4 text-center">
                <h2 class="heading">Connect With Us</h2>
                <div class="flex flex-col md:flex-row items-center justify-center space-x-0 md:space-x-8 mt-4 text-lg text-gray-700">
                    <p class="contact-info"><i class="fas fa-phone-alt text-emerald-500"></i><span>  9473228888</span></p>
                    <p class="contact-info"><i class="fas fa-envelope text-emerald-500"></i><span>  officialrotibankbettiah@gmail.com</span></p>
                    <p class="contact-info"><i class="fas fa-map-marker-alt text-emerald-500"></i><span>  Kalibag Chowk, Bettiah, West Champaran, Bihar, 845438</span></p>
                </div>
                <div class="flex justify-center space-x-6 text-emerald-500 text-4xl mt-6">
                    <a href="https://www.facebook.com/ROTIBANKBETTIAH?mibextid=ZbWKwL" target="_blank" class="hover:text-emerald-700 transition-colors duration-300">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="https://twitter.com/Rotibankbettiah?t=YHxDyMexihjbvZE6iPP2uw&s=09" target="_blank" class="hover:text-emerald-700 transition-colors duration-300">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://instagram.com/rotibankbettiah?igshid=ZDdkNTZiNTM=" target="_blank" class="hover:text-emerald-700 transition-colors duration-300">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="https://youtube.com/@Rotibankbettiah" target="_blank" class="hover:text-emerald-700 transition-colors duration-300">
                        <i class="fab fa-youtube"></i>
                    </a>
                    <a href="https://wa.me/+919473228888" target="_blank" class="hover:text-emerald-700 transition-colors duration-300">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 text-center">
        <div class="container mx-auto px-4">
            <p>&copy; 2024 Roti Bank Bettiah. All Rights Reserved.</p>
        </div>
    </footer>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
        
        // IMPORTANT: Replace with your actual Supabase project URL and public API key
        const SUPABASE_URL = 'https://rvkgeoqrxkxjmvdjiyli.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ2a2dlb3FyeGt4am12ZGppeWxpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0NDg4NzQsImV4cCI6MjA3MTAyNDg3NH0.9N2fioPJWAWIZYisDa5X_arw2YMpngxF5zw-GP1mP3I';

        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        let lastScrollY = window.scrollY;

        window.addEventListener('scroll', () => {
            const navbar = document.getElementById('navbar');
            if (window.scrollY > lastScrollY) {
                // Scrolling down
                navbar.classList.add('navbar-hidden');
            } else {
                // Scrolling up
                navbar.classList.remove('navbar-hidden');
            }
            lastScrollY = window.scrollY;
        });

        // Function to load content for a section when it becomes visible
        function lazyLoadSection(sectionId, loadFunction) {
            const section = document.getElementById(sectionId);
            if (!section) return;

            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        loadFunction();
                        observer.unobserve(entry.target);
                    }
                });
            }, {
                rootMargin: '0px 0px 100px 0px' // Load when 100px from viewport
            });

            observer.observe(section);
        }

        // Function to fetch and display the "About Us" content
        async function loadAboutContent() {
            const { data, error } = await supabase
                .from('about')
                .select('content')
                .single();

            const aboutContentContainer = document.getElementById('about-content-container');
            if (aboutContentContainer) {
                if (error) {
                    console.error("Error loading About Us content:", error);
                    aboutContentContainer.innerHTML = `<p class="text-lg text-gray-700 mb-6">Error loading content. Please try again later.</p>`;
                } else {
                    const truncatedContent = data.content.substring(0, 250) + '...';
                    aboutContentContainer.innerHTML = `<p class="text-lg text-gray-700 mb-6">${truncatedContent}</p>`;
                }
            }
        }

        // Function to fetch and display the hero banner image
        async function loadBanner() {
            const { data, error } = await supabase
                .from('banners')
                .select('imageUrl')
                .single();
            
            const homeHeader = document.getElementById('home');
            if (homeHeader && data) {
                homeHeader.style.backgroundImage = `url('${data.imageUrl}')`;
            }
        }
        
        // Function to fetch and display internship content
        async function loadInternshipContent() {
            const { data, error } = await supabase
                .from('internship_corner')
                .select('*');

            const internshipContentDiv = document.getElementById('internship-content');
            if (internshipContentDiv) {
                if (error) {
                    console.error("Error loading internship content:", error);
                    internshipContentDiv.innerHTML = '<p>Error loading content.</p>';
                    return;
                }

                internshipContentDiv.innerHTML = data.map(item => {
                    let html = '';
                    if (item.type === 'youtube') {
                        html = `<div class="aspect-w-16 aspect-h-9 max-w-2xl mx-auto"><br><iframe class="w-full h-full rounded-xl shadow-lg" src="${item.url}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe><br></div>`;
                    } else if (item.type === 'instagram') {
                        html = `<div class="card p-6 max-w-2xl mx-auto"><br><p class="text-lg text-gray-700 font-bold mb-2">Instagram Video</p><br><a href="${item.url}" target="_blank" class="text-blue-500 hover:underline break-words">${item.url}</a><br></div>`;
                    } else if (item.type === 'photo' || item.type === 'certificate') {
                         html = `<div class="card p-6 max-w-2xl mx-auto"><br><img src="${item.url}" alt="${item.type}" class="full-visible-image" loading="lazy"><br><p class="text-sm text-gray-500">${item.type === 'photo' ? 'Photo' : 'Certificate'}</p><br></div>`;
                    } else if (item.type === 'text' || item.type === 'criteria') {
                        html = `<div class="card p-6 max-w-2xl mx-auto"><br><p class="text-lg text-gray-700">${item.content}</p><br></div>`;
                    }
                    return html;
                }).join('');
            }
        }

        // Function to set the internship form button URL
        async function setInternshipFormUrl() {
            const { data, error } = await supabase
                .from('internship_form')
                .select('url')
                .single();

            const applyBtn = document.getElementById('apply-internship-btn');
            if (applyBtn && data) {
                applyBtn.onclick = () => window.open(data.url, '_blank');
            }
        }

        // Function to fetch and display donation details
        async function loadDonationDetails() {
            const { data, error } = await supabase
                .from('donations')
                .select('*')
                .single();

            if (data) {
                document.getElementById('account-holder-name').textContent = data.accountHolder || 'N/A';
                document.getElementById('bank-name').textContent = data.bankName || 'N/A';
                document.getElementById('account-number').textContent = data.accountNumber || 'N/A';
                document.getElementById('ifsc-code').textContent = data.ifscCode || 'N/A';
                const donationQR = document.getElementById('donation-qr');
                if (donationQR) {
                    donationQR.src = data.qrUrl || 'https://placehold.co/256x256/E5E7EB/9CA3AF?text=QR+Code';
                }
            }
        }

        // Function to fetch and display daily activities
        async function loadActivities() {
            const { data, error } = await supabase
                .from('activities')
                .select('*');

            const activitiesListContainer = document.getElementById('activities-list-container');
            if (activitiesListContainer) {
                if (error) {
                    console.error("Error loading activities:", error);
                    activitiesListContainer.innerHTML = '<p>Error loading activities.</p>';
                    return;
                }

                activitiesListContainer.innerHTML = '';
                data.forEach(activity => {
                    const activityElement = document.createElement('div');
                    activityElement.className = 'bg-white p-6 rounded-xl shadow-md space-y-2 relative';
                    let imageHtml = '';
                    let captionHtml = '';
                    if (activity.imageUrl) {
                        imageHtml = `<img src="${activity.imageUrl}" alt="${activity.title}" class="full-visible-image" loading="lazy">`;
                    }
                    if (activity.caption) {
                        captionHtml = `<p class="text-sm text-gray-500">${activity.caption}</p>`;
                    }
                    activityElement.innerHTML = `
                        ${imageHtml}
                        <h3 class="text-xl font-bold text-gray-800">${activity.title}</h3>
                        <p class="text-gray-600">${activity.content}</p>
                        ${captionHtml}
                    `;
                    activitiesListContainer.appendChild(activityElement);
                });
            }
        }


        // Function to fetch and display notices
        async function loadNotices() {
            const { data, error } = await supabase
                .from('notices')
                .select('*');
            
            const noticesListContainer = document.getElementById('notices-list-container');
            if (noticesListContainer) {
                if (error) {
                    console.error("Error loading notices:", error);
                    noticesListContainer.innerHTML = '<p>Error loading notices.</p>';
                    return;
                }
                
                noticesListContainer.innerHTML = '';
                data.forEach(notice => {
                    const noticeElement = document.createElement('div');
                    noticeElement.className = 'bg-white p-6 rounded-xl shadow-md space-y-2 relative';
                    let imageHtml = '';
                    if (notice.imageUrl) {
                        imageHtml = `<img src="${notice.imageUrl}" alt="${notice.title}" class="full-visible-image" loading="lazy">`;
                    }
                    noticeElement.innerHTML = `
                        ${imageHtml}
                        <h3 class="text-xl font-bold text-gray-800">${notice.title}</h3>
                        <p class="text-gray-600">${notice.content}</p>
                    `;
                    noticesListContainer.appendChild(noticeElement);
                });
            }
        }

        // Function to fetch and display achievements
        async function loadOurAchievements() {
            const { data, error } = await supabase
                .from('achievements')
                .select('*');

            const achievementsList = document.getElementById('achievements-list');
            if (achievementsList) {
                if (error) {
                    console.error("Error loading achievements:", error);
                    achievementsList.innerHTML = '<p>Error loading achievements.</p>';
                    return;
                }
                
                achievementsList.innerHTML = '';
                data.forEach(achievement => {
                    const achievementElement = document.createElement('div');
                    achievementElement.className = 'card flex flex-col items-center text-center';
                    
                    let imageHtml = '';
                    if (achievement.imageUrl) {
                        imageHtml = `<img src="${achievement.imageUrl}" alt="${achievement.caption || ''}" class="full-visible-image mb-4">`;
                    }

                    achievementElement.innerHTML = `
                        ${imageHtml}
                        <div class="icon-container mb-4">
                            <i class="fas ${achievement.icon} icon"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-800">${achievement.count}</h3>
                        <p class="text-gray-600">${achievement.description}</p>
                        ${achievement.caption ? `<p class="text-sm text-gray-500 mt-2">${achievement.caption}</p>` : ''}
                    `;
                    achievementsList.appendChild(achievementElement);
                });
            }
        }

        // Function to fetch and display causes
        async function loadCauses() {
            const { data, error } = await supabase
                .from('causes')
                .select('*');

            const causesList = document.getElementById('causes-list');
            if (causesList) {
                if (error) {
                    console.error("Error loading causes:", error);
                    causesList.innerHTML = '<p>Error loading causes.</p>';
                    return;
                }

                causesList.innerHTML = '';
                data.forEach(cause => {
                    const progress = (cause.completed / cause.target) * 100;
                    const causeElement = document.createElement('div');
                    causeElement.className = 'bg-white p-6 rounded-xl shadow-md space-y-2';
                    causeElement.innerHTML = `<br>
                        <h3 class="text-xl font-bold text-gray-800">${cause.name}</h3><br>
                        <p class="text-gray-600">Progress: ${cause.completed} out of ${cause.target} tasks completed</p><br>
                        <div class="w-full bg-gray-200 rounded-full h-2.5"><br>
                            <div class="bg-emerald-500 h-2.5 rounded-full" style="width: ${Math.min(progress, 100)}%;"></div><br>
                        </div><br>
                    `;
                    causesList.appendChild(causeElement);
                });
            }
        }

         // Function to fetch and display news
        async function loadNews() {
            const { data, error } = await supabase
                .from('news')
                .select('*');

            const newsList = document.getElementById('news-list');
            if (newsList) {
                if (error) {
                    console.error("Error loading news:", error);
                    newsList.innerHTML = '<p>Error loading news.</p>';
                    return;
                }
                
                newsList.innerHTML = '';
                data.forEach(newsItem => {
                    const date = newsItem.created_at ? new Date(newsItem.created_at).toLocaleDateString() : 'N/A';
                    const newsElement = document.createElement('div');
                    newsElement.className = 'bg-white p-6 rounded-xl shadow-md space-y-2 relative';
                    let imageHtml = '';
                    if (newsItem.imageUrl) {
                        imageHtml = `<img src="${newsItem.imageUrl}" alt="${newsItem.title}" class="full-visible-image" loading="lazy">`;
                    }
                    newsElement.innerHTML = `
                        ${imageHtml}
                        <h3 class="text-xl font-bold text-gray-800">${newsItem.title}</h3>
                        <p class="text-gray-600">${newsItem.content}</p>
                        <p class="text-sm text-gray-500">Published: ${date}</p>
                    `;
                    newsList.appendChild(newsElement);
                });
            }
        }
        // Function to fetch and display the "Our Branches" content
        async function loadBranches() {
            const { data, error } = await supabase
                .from('branches')
                .select('*');

            const branchesListContainer = document.getElementById('branches-list');
            if (branchesListContainer) {
                if (error) {
                    console.error("Error loading branches:", error);
                    branchesListContainer.innerHTML = '<p>Error loading branches.</p>';
                    return;
                }
                
                branchesListContainer.innerHTML = '';
                data.forEach(branch => {
                    const branchElement = document.createElement('div');
                    branchElement.className = 'card flex-1 p-6 text-center space-y-2';
                    branchElement.innerHTML = `
                        <h3 class="text-xl font-bold text-gray-800">${branch.name}</h3>
                        <p class="text-gray-700">${branch.location}</p>
                        ${branch.imageUrl ? `<img src="${branch.imageUrl}" alt="Image of ${branch.name}" class="full-visible-image">` : ''}
                    `;
                    branchesListContainer.appendChild(branchElement);
                });
            }
        }

        // Function to fetch and display gallery images
        let slideIndex = 0;
        let slideshowInterval;
        let isPaused = false;
        let galleryImages = [];
        let hasLoadedGallery = false;

        async function loadGallery() {
            if (hasLoadedGallery) return;
            hasLoadedGallery = true;

            const { data, error } = await supabase
                .from('gallery')
                .select('*');
            
            if (error || !data || data.length === 0) {
                console.error("Error loading gallery:", error);
                return;
            }
            
            galleryImages = data;
            showSlides();
            slideshowInterval = setInterval(() => plusSlides(1), 3000); // Start slideshow
        }

        function showSlides() {
            const slideshowContainer = document.getElementById('gallery-slideshow');
            if (!slideshowContainer || galleryImages.length === 0) return;

            // Clear previous slide and add the new one
            slideshowContainer.innerHTML = '';
            const img = document.createElement('img');
            img.src = galleryImages[slideIndex].imageUrl;
            img.alt = galleryImages[slideIndex].caption;
            img.className = 'slideshow-img fade';
            slideshowContainer.appendChild(img);
            
            // Increment slide index for next cycle
            slideIndex = (slideIndex + 1) % galleryImages.length;
            
            // Show the image
            const slides = document.getElementsByClassName("slideshow-img");
            if (slides.length > 0) {
                slides[0].style.display = "block";
            }
        }

        // Slideshow controls
        function plusSlides(n) {
            clearInterval(slideshowInterval);
            slideIndex = (slideIndex + n + galleryImages.length) % galleryImages.length;
            showSlides();
            slideshowInterval = setInterval(() => plusSlides(1), 3000);
        }

        function togglePause() {
            const pauseBtn = document.getElementById('pause-btn');
            if (isPaused) {
                slideshowInterval = setInterval(() => plusSlides(1), 3000);
                pauseBtn.textContent = 'Pause';
            } else {
                clearInterval(slideshowInterval);
                pauseBtn.textContent = 'Play';
            }
            isPaused = !isPaused;
        }

        // Event handler for receipt generation
        function handleReceiptGeneration(e) {
            e.preventDefault();
            const donarName = document.getElementById('donar-name').value;
            const amount = document.getElementById('amount').value;
            const transactionId = document.getElementById('transaction-id').value;
            const date = new Date().toLocaleDateString();
            const messageBox = document.getElementById('message-box');

            if (!donarName || !amount || !transactionId) {
                messageBox.textContent = "Please fill out all the fields to generate the receipt.";
                messageBox.classList.remove('hidden');
                setTimeout(() => messageBox.classList.add('hidden'), 5000);
                return;
            }

            const receiptHtml = `<div style="font-family: 'Inter', sans-serif; padding: 2rem; border: 2px solid #047857; border-radius: 1rem; max-width: 600px; margin: 2rem auto;"><h2 style="font-size: 1.5rem; font-weight: bold; text-align: center; color: #047857; margin-bottom: 1rem;">Donation Receipt</h2><div style="border-top: 1px dashed #ccc; padding-top: 1rem; margin-top: 1rem;"><p style="margin-bottom: 0.5rem;"><strong style="color: #4b5563;">Organization:</strong> Roti Bank Bettiah</p><p style="margin-bottom: 0.5rem;"><strong style="color: #4b5563;">Donar Name:</strong> ${donarName}</p><p style="margin-bottom: 0.5rem;"><strong style="color: #4b5563;">Amount:</strong> ₹${amount}</p><p style="margin-bottom: 0.5rem;"><strong style="color: #4b5563;">Transaction ID:</strong> ${transactionId}</p><p style="margin-bottom: 0.5rem;"><strong style="color: #4b5563;">Date of Donation:</strong> ${date}</p></div><p style="text-align: center; color: #6b7280; margin-top: 1rem;">Thank you for your generous contribution!</p></div>`;

            const receiptWindow = window.open('', '_blank');
            if (receiptWindow) {
                receiptWindow.document.write(receiptHtml);
                receiptWindow.document.close();
                setTimeout(() => { receiptWindow.print(); }, 500);
                messageBox.textContent = "Receipt generated and opened in a new tab for printing.";
                messageBox.classList.remove('hidden');
                setTimeout(() => messageBox.classList.add('hidden'), 5000);
            } else {
                messageBox.textContent = "Please allow pop-ups to generate the receipt.";
                messageBox.classList.remove('hidden');
                setTimeout(() => messageBox.classList.add('hidden'), 5000);
            }
            document.getElementById('receipt-form').reset();
        }

        // Set up event listeners
        document.getElementById('prev-btn').onclick = () => plusSlides(-1);
        document.getElementById('next-btn').onclick = () => plusSlides(1);
        document.getElementById('pause-btn').onclick = () => togglePause();
        
        const receiptForm = document.getElementById('receipt-form');
        if (receiptForm) {
            receiptForm.addEventListener('submit', handleReceiptGeneration);
        }

        // Initial loads and lazy loads
        loadAboutContent();
        loadBanner();
        loadDonationDetails();
        loadActivities();
        loadNotices();
        loadCauses();
        setInternshipFormUrl();
        loadBranches();

        lazyLoadSection('news', loadNews);
        lazyLoadSection('gallery', loadGallery);
        lazyLoadSection('internship', loadInternshipContent);
        lazyLoadSection('notices',loadNotices);
        lazyLoadSection('activities',loadActivities);
        lazyLoadSection('achievements',loadOurAchievements)

    </script>
    <!-- ========================================================================================================= -->
    <!-- --- END OF ORIGINAL ROTI BANK BETTIAH CONTENT --- -->
    <!-- ========================================================================================================= -->


    <script>
        // --- 1. Chatbot Logic (Updated with Persona and Donation Link) ---
        
        // API Key updated with the latest key provided by the user
        const API_KEY = "AIzaSyC2XHDzeNKxLp-ccI4SidgVZTbJLgA16oc"; 
        
        // --- UPDATED: Using the user-uploaded QR code image file name ---
        const MOCK_QR_CODE_URL = "QR.png.jpg"; 
        const MOCK_DONATION_LINK = "#donation"; // Links to the Donation section of this page

        // System Instruction for Gemini Model
        const SYSTEM_INSTRUCTION = "You are the helpful and compassionate Roti Bank Bettiah assistant. Your goal is to provide accurate, concise, and direct information about the organization's mission, volunteering, and operational details in Bettiah, Bihar. Always answer maintaining the organization's professional and empathetic voice. Only answer questions related to the Roti Bank Bettiah organization and its charity work (food distribution, volunteering, etc.). Do not answer off-topic questions.";

        const chatWidget = document.getElementById('chat-widget');
        const chatbotIcon = document.getElementById('chatbot-icon');
        const chatCloseBtn = document.getElementById('chat-close-btn');
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');
        const chatContainer = document.getElementById('chat-container');

        // Toggle chat widget visibility
        chatbotIcon.addEventListener('click', () => {
            chatWidget.style.display = 'flex';
        });

        chatCloseBtn.addEventListener('click', () => {
            chatWidget.style.display = 'none';
        });


        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const userMessage = userInput.value.trim();
            if (!userMessage) return;

            // Display user message
            addMessage(userMessage, 'user');
            userInput.value = '';

            // Show typing indicator
            const typingIndicator = addMessage(null, 'ai', true);

            try {
                if (!API_KEY) {
                    throw new Error("API_KEY is missing.");
                }

                // Call the Gemini API or use the custom donation response
                const modelResponse = await callGeminiAPI(userMessage);
                
                // Remove typing indicator
                if (typingIndicator.parentNode) typingIndicator.remove();
                
                // Display AI response
                addMessage(modelResponse, 'ai');

            } catch (error) {
                console.error('Error calling Gemini API:', error);
                
                // Remove typing indicator
                if (typingIndicator.parentNode) typingIndicator.remove();
                
                // Display a clear error message to the user
                const errorMessage = `**API Error:** ${error.message.includes("API key not valid") ? "The API key provided is invalid or inactive. Please check your Google AI Studio settings." : error.message}`;
                addMessage(errorMessage, 'ai');
            }
        });

        /**
         * Adds a message bubble to the chat container, handling basic formatting and HTML for the donation response.
         */
        function addMessage(message, sender, isTyping = false) {
            const messageGroup = document.createElement('div');
            // Use 'flex-end' for user and 'flex-start' for AI to control horizontal alignment
            messageGroup.className = `message-group flex mb-3 ${sender === 'user' ? 'justify-end' : 'justify-start'}`;

            const messageBubble = document.createElement('div');
            // Initial class setup
            messageBubble.className = `p-3 max-w-[80%] text-sm ${sender === 'user' ? 'message-bubble-user' : 'message-bubble-ai'}`;
            
            if (isTyping) {
                // Custom typing indicator with dots
                messageBubble.innerHTML = `
                    <p class="text-gray-700 flex items-center">
                        Typing
                        <span class="dot ml-1"></span>
                        <span class="dot"></span>
                        <span class="dot"></span>
                    </p>`;
                messageBubble.classList.remove('message-bubble-ai');
                messageBubble.classList.add('bg-gray-200');

            } else {
                // Check if the message contains HTML (specifically <img> or <a> from the donation response)
                if (sender === 'ai' && (message.includes('<img src=') || message.includes('<a href='))) {
                    // For donation response, insert the raw HTML directly
                    messageBubble.innerHTML = message;
                    // Adjust alignment for content that should be centered (like the QR code/link)
                    messageBubble.classList.add('flex', 'flex-col', 'items-center', 'text-center');
                } else {
                    // Simple formatting for **bold** and *italic* text for regular LLM responses
                    let formattedMessage = message.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    formattedMessage = formattedMessage.replace(/\*(.*?)\*/g, '<em>$1</em>');
                    
                    messageBubble.innerHTML = `<p class="whitespace-pre-wrap">${formattedMessage}</p>`;
                    messageBubble.classList.remove('flex', 'flex-col', 'items-center', 'text-center');
                }
            }
            
            messageGroup.appendChild(messageBubble);
            chatContainer.appendChild(messageGroup);
            chatContainer.scrollTop = chatContainer.scrollHeight; // Auto-scroll
            return messageGroup;
        }

        /**
         * Calls the Google Gemini API with the given prompt, or returns a custom donation response.
         */
        async function callGeminiAPI(prompt) {
            // 1. Check for donation keywords for a guaranteed, custom response
            const lowerCasePrompt = prompt.toLowerCase();
            const donationKeywords = ['donate', 'donation', 'contribute', 'fund', 'qr code', 'bank details', 'pay'];

            if (donationKeywords.some(keyword => lowerCasePrompt.includes(keyword))) {
                const donationResponse = `On behalf of Roti Bank Bettiah, thank you for your compassion! Every contribution helps us fight hunger in Bettiah.
                
To make a difference, you can use the QR code below for direct payment or visit our donation section for bank details:
    
<img src="${MOCK_QR_CODE_URL}" alt="Roti Bank Bettiah Donation QR Code" class="w-32 h-32 rounded-lg my-3 shadow-lg">
    
<a href="${MOCK_DONATION_LINK}" target="_self" class="text-green-600 hover:underline font-semibold block text-center mt-2 p-1 bg-green-100 rounded-lg">View Full Donation Details</a>
    
We are grateful for your support in feeding the needy.`;
                return donationResponse;
            }

            // 2. Proceed with LLM call for other queries (Persona enforced via SYSTEM_INSTRUCTION)
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`;
            
            const payload = {
                contents: [{
                    parts: [{
                        text: prompt
                    }]
                }],
                systemInstruction: {
                    parts: [{
                        text: SYSTEM_INSTRUCTION
                    }]
                },
            };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorText = await response.text();
                let errorMessage = `HTTP error! status: ${response.status}`;
                try {
                    const errorData = JSON.parse(errorText);
                    errorMessage = errorData.error?.message || errorMessage;
                } catch(e) { /* silent fail */ }
                throw new Error(errorMessage);
            }

            const data = await response.json();
            const candidate = data.candidates?.[0];

            if (candidate && candidate.content?.parts?.[0]?.text) {
                return candidate.content.parts[0].text;
            } else {
                // If the response is empty, it's likely due to the safety filter blocking an off-topic question.
                return "I'm sorry, as the Roti Bank Bettiah assistant, I can only provide information about our charity work, mission, and how to get involved. Please ask a question related to Roti Bank Bettiah.";
            }
        }


        // --- 2. Original Roti Bank Website Scripts (Simplified/Mocked) ---

        // Function to handle mobile menu toggle
        document.getElementById('mobile-menu-button').addEventListener('click', () => {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        });

        // Mock function for receipt generation
        const messageBox = document.getElementById('message-box');
        document.getElementById('receipt-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('name').value;
            const amount = document.getElementById('amount').value;
            
            messageBox.textContent = `Thank you, ${name}, for your donation of INR ${amount}. A mock receipt has been generated.`;
            messageBox.classList.remove('hidden', 'bg-red-100', 'text-red-700');
            messageBox.classList.add('bg-green-100', 'text-green-700');
            
            setTimeout(() => {
                messageBox.classList.add('hidden');
                document.getElementById('receipt-modal').classList.add('hidden');
            }, 3000);
            document.getElementById('receipt-form').reset();
        });
    </script>
</body>
</html>
